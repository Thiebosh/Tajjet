<?php ob_start();?>
    <div class="col-lg-12 text-center">
        <h1>Chercher une recette</h1>
        <hr>
    </div>
    <div class="d-flex justify-content-center">
        <form class="w-100 row" method="post" action="index.php?page=cooking" id="plats"><!-- partie recherche seule -->
            <select class="custom-select col-lg m-3" name="type" size=1> <!--Liste déroulante des types de plats (entrées,desserts...)-->
                <?php foreach($typeList as $type) { ?>
                    <option><?= $type->getLabel() ?>
                <?php } ?>
            </select>
            <input require class="col-lg form-control m-3" type="text" name="search" placeholder="Nom de recette">
            <input class="col-lg btn btn-primary m-3 buttonNav" type="submit" value="Rechercher">
        </form>
    </div>
    
    <article class="recette">
        <div classe="col-md-12 text-center">
            <div class="d-flex justify-content-center my-3"><h1 id="nom_recette"><?= $recipe->getName() ?></h1></div>
            <div class="d-flex justify-content-center"><img class="col-lg-3" src="<?= $recipe->getPicture() ?>" alt="Image recette"></div>
            
            <div class="row my-4" id="times">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-12" id="timeGlobal">
                            Temps total : <?= intval(explode(':',$recipe->getTotalTime())[0]) ?> heure(s)
                            et <?= intval(explode(':',$recipe->getTotalTime())[1]) ?> minute(s)
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6" id="timePrep">
                            Temps de préparation :
                            <?= intval(explode(':',$recipe->getPreparationTime())[0]) ?> heure(s)
                            et <?= intval(explode(':',$recipe->getPreparationTime())[1]) ?> minute(s)
                        </div>
                        <div class="col-md-6" id="timeCook">
                            Temps de cuisson : 
                            <?= intval(explode(':',$recipe->getCookingTime())[0]) ?> heure(s)
                            et <?= intval(explode(':',$recipe->getCookingTime())[1]) ?> minute(s)
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row text-center">
                <div class="col-md-3 mt-3">
                    <p class="note">Note : <?= htmlspecialchars($recipe->getScore()) ?>/5</p> 
                </div>
                <div class="col-md-3 mt-3">
                    <p class="difficulty">Difficulté : <?= \ForceUTF8\Encoding::toUTF8($recipe->getDifficulty()) ?></p>
                </div>
                <div class="col-md-3 mt-3">
                    <p class="price">Budget : <?= \ForceUTF8\Encoding::toUTF8($recipe->getPrice()) ?></p>
                </div>
                <div class="col-md-3 mt-3">
                    <p class="price">Personne : <?= \ForceUTF8\Encoding::toUTF8($recipe->getNbPerson()) ?></p>
                </div>                
            </div>
            <hr>
            <div class="row mb-3">
                <div class="col-md text-center">
                    <h2>Etapes de préparation :</h2>    
                    <ul>
                        <?php 
                            $i = 0;
                            $lines = explode('<br>',$recipe->getSteps());
                            $limit = count($lines);
                            foreach ($lines as $line) { 
                                if (++$i < $limit) { ?>
                                    <li><?= $i.'. '.\ForceUTF8\Encoding::toUTF8($line) ?></li>
                                <?php }    
                        } ?>
                    </ul>
                    <form method="post" action="index.php?page=home"><!--soit ça soit message de confirmation au rechargement-->
                        <input type="hidden" name="calories" value="<?= $recipe->getCalories() ?>">
                        <input type="submit" class="btn btn-success" value="Je prépare cette recette"/>
                    </form>
                </div>
                <div class="col-md text-center">
                    <h2>Liste des ingrédients :</h2> 
                    <ul>
                        <?php 
                            $i = 0;
                            $lines = explode('<br>',$recipe->getIngredients());
                            $limit = count($lines);
                            foreach ($lines as $line) { 
                                if (++$i < $limit) { ?>
                                    <li><?= '* '.\ForceUTF8\Encoding::toUTF8($line) ?></li>
                                <?php }    
                        } ?>
                    </ul>
                    <?php 
                    $test = str_replace("'", "&#146", $recipe->getIngredients());
                    ?>
                    <button class="btn btn-success" onclick="downloadFile('<?= $test ?>')">Je télécharge la liste d'ingrédient</button>
                </div>
            </div>
        </div>
    </article>
    <script>
        function downloadFile(data, name = 'file', type = 'text/plain') {
            const { createElement } = document
            const { URL: { createObjectURL, revokeObjectURL }, setTimeout } = window
            
            while(data.search("<br>") != -1) {
                data = data.replace("<br>", "\n")
            }
            
            const blob = new Blob([data], { type })
            const url = createObjectURL(blob)

            const anchor = document.createElement("a")
            anchor.setAttribute('href', url)
            anchor.setAttribute('download', name)
            anchor.click()
            
            setTimeout(() => { revokeObjectURL(url) }, 100)
            }
    </script>
<?php $sectionContent=ob_get_clean();